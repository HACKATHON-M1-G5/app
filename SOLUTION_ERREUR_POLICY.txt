╔══════════════════════════════════════════════════════════════════════════╗
║                      🔧 SOLUTION RAPIDE                                   ║
║         ERROR: policy "allow_all_userdatas" already exists               ║
╚══════════════════════════════════════════════════════════════════════════╝

📋 ÉTAPES À SUIVRE :

1️⃣  Ouvrir le Dashboard Supabase
    → Aller sur votre projet Supabase

2️⃣  Ouvrir SQL Editor
    → Menu de gauche : "SQL Editor"

3️⃣  Exécuter le script de correction
    → Ouvrir le fichier : supabase/migrations/FIX_POLICIES_CONFLICT.sql
    → Copier TOUT le contenu
    → Coller dans l'éditeur SQL
    → Cliquer sur "Run" (ou Ctrl/Cmd + Enter)

4️⃣  Vérifier le résultat
    ✅ Vous devriez voir :
       - "✅ Fonctions RPC" avec increment_user_tokens et increment_team_tokens
       - "✅ Politiques RLS" avec allow_all_userdatas et allow_all_team_userdata
       - "✅ RLS Status" avec Activé pour les deux tables
       - Message : "🎯 Le système de distribution des gains est maintenant opérationnel !"

5️⃣  C'EST FAIT !
    → Le système de distribution des gains fonctionne maintenant
    → Vous pouvez définir des résultats et les gains seront distribués automatiquement

═══════════════════════════════════════════════════════════════════════════

📁 FICHIERS IMPORTANTS :

✅ supabase/migrations/FIX_POLICIES_CONFLICT.sql  ← EXÉCUTER CELUI-CI
✅ supabase/README_FIX.md                          ← Guide détaillé
✅ supabase/test_distribution.sql                  ← Pour tester après
✅ GUIDE_DISTRIBUTION_GAINS.md                     ← Documentation complète

═══════════════════════════════════════════════════════════════════════════

💡 CE QUE FAIT LE SCRIPT :

1. Supprime TOUTES les anciennes politiques (sans erreur)
2. Nettoie tout conflit potentiel
3. Crée les fonctions RPC pour la distribution des gains
4. Crée les nouvelles politiques permissives
5. Active RLS sur les tables
6. Affiche un résumé de confirmation

Le script est SÛR à exécuter plusieurs fois !

═══════════════════════════════════════════════════════════════════════════

🆘 SOLUTION ALTERNATIVE (si vraiment bloqué) :

Exécutez ceci dans SQL Editor :

    DROP POLICY IF EXISTS "allow_all_userdatas" ON "UserDatas";
    DROP POLICY IF EXISTS "allow_all_team_userdata" ON team_userdata;

Puis ré-exécutez FIX_POLICIES_CONFLICT.sql

═══════════════════════════════════════════════════════════════════════════

